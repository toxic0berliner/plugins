{% from 'OPNsense/Macros/interface.macro' import physical_interface %}
daemon={{OPNsense.DynDNS.general.daemon_delay|default('300')}}
syslog=yes                  # log update msgs to syslog
pid=/var/run/ddclient.pid   # record PID in file.
{% if not helpers.empty('OPNsense.DynDNS.general.force_ssl') %}
ssl=yes
{% endif %}
{% if not helpers.empty('OPNsense.DynDNS.general.verbose') %}
verbose=yes
{% endif %}


{%  if helpers.exists('OPNsense.DynDNS.accounts.account') %}
{%    for account in helpers.toList('OPNsense.DynDNS.accounts.account') %}
{%        if account.enabled|default('0') == '1' %}
{%            if account.checkip == 'if' %}
use=if, if={{physical_interface(account.interface)}}, \
{%            elif account.checkip is defined %}
{%                if account.interface is defined %}
use=cmd, cmd="/usr/local/opnsense/scripts/ddclient/fetch-address --service={{account.checkip}} --scheme={{account.checkipscheme}} --ip-version={{account.checkipversion}} --interface={{physical_interface(account.interface)}}",
{%                else %}
use=cmd, cmd="/usr/local/opnsense/scripts/ddclient/fetch-address --service={{account.checkip}} --scheme={{account.checkipscheme}} --ip-version={{account.checkipversion}}",
{%                endif %}
{%            endif %}
{%            if account.service == 'custom' %}
protocol={{account.protocol}}, \
server={{account.server}}, \
{%            elif account.service == 'cloudflare' %}
protocol=cloudflare, \
zone={{account.zone}}, \
{%            elif account.service == 'dnsmadeeasy' %}
protocol=dnsmadeeasy, \
{%            elif account.service == 'dns-o-matic' %}
protocol=dyndns2, \
server=updates.dnsomatic.com, \
{%            elif account.service == 'freedns' %}
protocol=freedns, \
server=freedns.afraid.org, \
{%            elif account.service == 'dynu' %}
protocol=dyndns2, \
server=api.dynu.com, \
{%            elif account.service == 'he-net' %}
protocol=dyndns2, \
server=dyn.dns.he.net, \
{%            elif account.service == 'he-net-tunnel' %}
protocol=dyndns2, \
server=ipv4.tunnelbroker.net, \
{%            elif account.service == 'inwx' %}
protocol=dyndns2, \
server=dyndns.inwx.com, \
{%            elif account.service == 'loopia' %}
protocol=dyndns2, \
server=dyndns.loopia.se, \
{%            elif account.service == 'nsupdatev4' %}
protocol=dyndns2, \
server=ipv4.nsupdate.info, \
{%            elif account.service == 'nsupdatev6' %}
protocol=dyndns2, \
server=ipv6.nsupdate.info, \
{%            elif account.service == 'spdyn' %}
protocol=dyndns2, \
server=update.spdyn.de, \
{%            elif account.service == 'strato' %}
protocol=dyndns2, \
server=dyndns.strato.com, \
{%            elif account.service == 'ovh' %}
protocol=dyndns2, \
server=www.ovh.com, \
{%            else %}
protocol={{account.service}}, \
{%            endif %}
{%            if account.wildcard|default('0') == '1' %}
wildcard=yes, \
{%            endif %}
{%            if account.username %}
login={{account.username}}, \
{%            endif %}
password={{account.password}} \
{{account.hostnames}}

{%        endif %}
{%    endfor %}
{%  endif %}
